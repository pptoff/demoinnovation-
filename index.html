<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smart Asset - Final Full Scale</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
            background: #0f172a;
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            user-select: none;
        }

        /* DEVICE FRAME */
        .device-frame {
            width: 400px;
            height: 880px; /* ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
            background: #000;
            border-radius: 55px;
            border: 14px solid #333;
            position: relative;
            box-shadow: 0 0 80px rgba(0,0,0,0.6);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            z-index: 10;
        }

        .dynamic-island {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 126px;
            height: 37px;
            background: #000;
            border-radius: 20px;
            z-index: 999;
        }

        .status-bar {
            height: 50px;
            padding: 0 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            font-weight: 600;
            color: #000;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(5px);
            z-index: 100;
            padding-top: 10px;
        }

        /* NOTIFICATION */
        .notification-banner {
            position: absolute;
            top: -120px;
            left: 12px;
            right: 12px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(15px);
            border-radius: 18px;
            padding: 12px 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            z-index: 1000;
            display: flex;
            gap: 12px;
            transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            border: 1px solid rgba(0,0,0,0.05);
        }
        .notification-banner.show { top: 60px; }

        /* APP LAYOUT */
        .screen-layer {
            flex: 1;
            background: #f8fafc;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .app-content { 
            flex: 1; 
            overflow-y: auto; 
            overflow-x: hidden;
            padding-bottom: 100px; 
        }
        .app-content::-webkit-scrollbar { display: none; }

        .tab-bar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 85px;
            background: rgba(255,255,255,0.98);
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 25px;
            z-index: 50;
        }
        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #94a3b8;
            transition: 0.2s;
            cursor: pointer;
            height: 100%;
        }
        .tab-item.active { color: #2563eb; transform: translateY(-2px); font-weight: 700; }
        .tab-item i { font-size: 24px; margin-bottom: 4px; }
        .tab-item:active { transform: scale(0.9); }

        /* LINE APP */
        #app-line { 
            height: 100%; 
            background: #849ebf; 
            display: none; 
            flex-direction: column; 
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: 200;
        }

        /* ROLE SWITCHER */
        .role-switcher {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 40px;
            padding: 8px;
            display: flex;
            gap: 12px;
            z-index: 20;
        }
        .role-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .role-btn:hover { transform: translateY(-5px); }
        .role-btn.active { box-shadow: 0 0 20px currentColor; transform: scale(1.15); border: 2px solid white; }
        .role-btn::after {
            content: attr(data-label);
            position: absolute;
            bottom: -25px;
            font-size: 10px;
            opacity: 0;
            transition: 0.2s;
            white-space: nowrap;
            font-weight: bold;
            text-shadow: 0 1px 2px black;
        }
        .role-btn:hover::after { opacity: 1; bottom: -30px; }

        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div class="device-frame">
        <div class="dynamic-island"></div>
        <div class="status-bar">
            <span id="clock" class="font-mono">10:00</span>
            <div class="flex gap-1.5 text-xs">
                <i class="fas fa-signal"></i><i class="fas fa-wifi"></i><i class="fas fa-battery-full"></i>
            </div>
        </div>

        <div id="notification" class="notification-banner" onclick="openLineApp()">
            <div class="w-10 h-10 bg-[#06c755] rounded-xl flex items-center justify-center text-white text-2xl shadow-sm"><i class="fab fa-line"></i></div>
            <div class="flex-1 min-w-0">
                <div class="flex justify-between items-center mb-0.5"><span class="font-bold text-xs text-gray-800">LINE</span><span class="text-[10px] text-gray-500">Now</span></div>
                <div class="font-semibold text-sm text-gray-900 truncate">Klongtoey Smart Asset</div>
                <div class="text-xs text-gray-500 truncate" id="notif-text">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡∏°‡πà...</div>
            </div>
        </div>

        <div class="screen-layer">
            <div id="app-smart-asset" class="h-full flex flex-col">
                <header class="bg-white/90 backdrop-blur-md px-5 py-4 shadow-sm flex justify-between items-center sticky top-0 z-40 transition-all">
                    <div>
                        <h1 class="font-bold text-xl text-slate-800" id="header-title">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏</h1>
                        <span class="text-[10px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-500 font-semibold tracking-wide" id="role-badge">USER MODE</span>
                    </div>
                    <div id="admin-action-btn" class="hidden">
                        <button onclick="adminAddAsset()" class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-lg active:scale-90 transition"><i class="fas fa-plus"></i></button>
                    </div>
                    <div id="profile-btn" class="relative group cursor-pointer" onclick="Swal.fire('Profile', 'User: ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢<br>Credit: A+', 'info')">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-indigo-600 p-[2px]">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" class="rounded-full bg-white h-full w-full">
                        </div>
                    </div>
                </header>

                <div class="app-content" id="main-view"></div>
                <div class="tab-bar" id="tab-bar"></div>
            </div>

            <div id="app-line">
                <div class="bg-[#212b36] text-white p-4 pt-12 flex items-center gap-3 shadow-md z-10">
                    <i class="fas fa-chevron-left text-xl cursor-pointer p-2" onclick="closeLineApp()"></i>
                    <div class="flex-1"><h3 class="font-bold text-base">Klongtoey Asset Bot</h3><span class="text-[10px] bg-green-500/20 text-green-400 px-1.5 rounded">Official Account</span></div>
                </div>
                <div class="flex-1 p-4 overflow-y-auto flex flex-col gap-4 bg-[#849ebf]" id="chat-history"></div>
                <div class="bg-white p-2 pb-8 flex items-center gap-2 border-t border-gray-300">
                    <i class="fas fa-plus text-[#212b36] p-2 text-xl"></i><input type="text" placeholder="Aa" class="flex-1 bg-gray-100 rounded-full h-9 px-4 text-sm" disabled><i class="fas fa-microphone text-[#212b36] p-2 text-xl"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="role-switcher">
        <button class="role-btn bg-blue-500 active" onclick="switchRole('user')" data-label="User"><i class="fas fa-user"></i></button>
        <button class="role-btn bg-green-500" onclick="switchRole('staff')" data-label="Staff"><i class="fas fa-id-badge"></i></button>
        <button class="role-btn bg-orange-500" onclick="switchRole('admin')" data-label="Admin"><i class="fas fa-tools"></i></button>
        <button class="role-btn bg-purple-500" onclick="switchRole('exec')" data-label="Executive"><i class="fas fa-chart-line"></i></button>
    </div>

    <script>
        // --- BIG DATA MOCKUP (28+ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏™‡∏±‡πà‡∏á) ---
        const DB = {
            assets: [
                // Furniture
                { id: 1, name: "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å (‡∏Ç‡∏≤‡∏ß)", stock: 500, available: 450, img: "ü™ë", cat: "fur", badge: "Hot" },
                { id: 2, name: "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å (‡πÅ‡∏î‡∏á)", stock: 200, available: 180, img: "ü™ë", cat: "fur", badge: "" },
                { id: 3, name: "‡πÇ‡∏ï‡πä‡∏∞‡∏û‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏ß 1.2‡∏°.", stock: 100, available: 20, img: "üü´", cat: "fur", badge: "Low Stock" },
                { id: 4, name: "‡πÇ‡∏ï‡πä‡∏∞‡∏Å‡∏•‡∏°‡∏à‡∏µ‡∏ô", stock: 50, available: 45, img: "‚≠ï", cat: "fur", badge: "" },
                { id: 5, name: "‡πÇ‡∏ã‡∏ü‡∏≤‡∏£‡∏±‡∏ö‡πÅ‡∏Ç‡∏Å (‡∏ä‡∏∏‡∏î)", stock: 5, available: 2, img: "üõãÔ∏è", cat: "fur", badge: "" },
                { id: 24, name: "‡πÇ‡∏û‡πÄ‡∏î‡∏µ‡∏¢‡∏°‡∏≠‡∏∞‡∏Ñ‡∏£‡∏¥‡∏•‡∏¥‡∏Ñ", stock: 2, available: 2, img: "üé§", cat: "fur", badge: "New" },
                { id: 25, name: "‡∏û‡∏£‡∏°‡πÅ‡∏î‡∏á (‡∏°‡πâ‡∏ß‡∏ô)", stock: 10, available: 8, img: "üß∂", cat: "fur", badge: "" },
                // Tech
                { id: 6, name: "‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÄ‡∏ï‡∏≠‡∏£‡πå Epson", stock: 10, available: 8, img: "üìΩÔ∏è", cat: "tech", badge: "Best" },
                { id: 7, name: "‡∏à‡∏≠‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏û 100 ‡∏ô‡∏¥‡πâ‡∏ß", stock: 10, available: 9, img: "‚¨ú", cat: "tech", badge: "" },
                { id: 8, name: "‡∏™‡∏≤‡∏¢ HDMI ‡∏¢‡∏≤‡∏ß 10‡∏°.", stock: 20, available: 15, img: "üîå", cat: "tech", badge: "" },
                { id: 9, name: "‡∏õ‡∏•‡∏±‡πä‡∏Å‡∏û‡πà‡∏ß‡∏á 5 ‡πÄ‡∏°‡∏ï‡∏£", stock: 30, available: 25, img: "‚ö°", cat: "tech", badge: "" },
                { id: 26, name: "Pointer ‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠", stock: 5, available: 5, img: "üñäÔ∏è", cat: "tech", badge: "" },
                // Audio
                { id: 10, name: "‡∏ä‡∏∏‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏ô‡∏≤‡∏°", stock: 4, available: 1, img: "üîä", cat: "audio", badge: "Low Stock" },
                { id: 11, name: "‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÑ‡∏£‡πâ‡∏™‡∏≤‡∏¢ (‡∏Ñ‡∏π‡πà)", stock: 15, available: 10, img: "üé§", cat: "audio", badge: "Hot" },
                { id: 12, name: "‡∏Ç‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏°‡∏Ñ‡πå", stock: 20, available: 18, img: "üéôÔ∏è", cat: "audio", badge: "" },
                { id: 13, name: "‡∏•‡∏≥‡πÇ‡∏û‡∏á‡∏ö‡∏•‡∏π‡∏ó‡∏π‡∏ò‡∏û‡∏Å‡∏û‡∏≤", stock: 10, available: 10, img: "üìª", cat: "audio", badge: "" },
                // Outdoor
                { id: 14, name: "‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏ú‡πâ‡∏≤‡πÉ‡∏ö 3x3m", stock: 50, available: 0, img: "‚õ∫", cat: "out", badge: "Out of Stock" },
                { id: 15, name: "‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏ú‡πâ‡∏≤‡πÉ‡∏ö 5x5m", stock: 20, available: 5, img: "üé™", cat: "out", badge: "" },
                { id: 16, name: "‡∏û‡∏±‡∏î‡∏•‡∏°‡πÑ‡∏≠‡∏ô‡πâ‡∏≥‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°", stock: 15, available: 12, img: "üí®", cat: "out", badge: "Popular" },
                { id: 17, name: "‡∏Å‡∏£‡∏∞‡∏ï‡∏¥‡∏Å‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á 100L", stock: 10, available: 8, img: "üßä", cat: "out", badge: "" },
                { id: 27, name: "‡∏£‡πà‡∏°‡∏™‡∏ô‡∏≤‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà", stock: 30, available: 25, img: "‚õ±Ô∏è", cat: "out", badge: "" },
                // Traffic
                { id: 18, name: "‡πÅ‡∏ú‡∏á‡∏Å‡∏±‡πâ‡∏ô‡∏à‡∏£‡∏≤‡∏à‡∏£", stock: 100, available: 80, img: "üöß", cat: "traf", badge: "" },
                { id: 19, name: "‡∏Å‡∏£‡∏ß‡∏¢‡∏à‡∏£‡∏≤‡∏à‡∏£", stock: 200, available: 150, img: "‚ö†Ô∏è", cat: "traf", badge: "" },
                { id: 20, name: "‡πÑ‡∏ü‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡πÇ‡∏ã‡∏•‡πà‡∏≤‡πÄ‡∏ã‡∏•‡∏•‡πå", stock: 50, available: 48, img: "üö®", cat: "traf", badge: "" },
                // Tools
                { id: 21, name: "‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡∏û‡∏±‡∏™‡∏î‡∏∏", stock: 5, available: 2, img: "üõí", cat: "tool", badge: "" },
                { id: 22, name: "‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡∏≠‡∏•‡∏π‡∏°‡∏¥‡πÄ‡∏ô‡∏µ‡∏¢‡∏°", stock: 3, available: 3, img: "ü™ú", cat: "tool", badge: "" },
                { id: 23, name: "‡∏™‡∏ß‡πà‡∏≤‡∏ô‡πÑ‡∏£‡πâ‡∏™‡∏≤‡∏¢", stock: 5, available: 1, img: "üî©", cat: "tool", badge: "Maintain" },
            ],
            users: [
                { id: 'U001', name: '‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏£‡∏±‡∏Å‡∏î‡∏µ', role: 'User', status: true },
                { id: 'U002', name: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à', role: 'User', status: false },
                { id: 'U003', name: 'Admin Klongtoey', role: 'Staff', status: true },
            ],
            requests: [
                { id: 'R-998', user: '‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à', items: '‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏ú‡πâ‡∏≤‡πÉ‡∏ö x2', status: 'pending', date: '09:30' },
                { id: 'R-997', user: '‡∏ß‡∏¥‡∏ä‡∏±‡∏¢ ‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≤‡∏á', items: '‡∏£‡∏ñ‡πÄ‡∏Ç‡πá‡∏ô‡∏û‡∏±‡∏™‡∏î‡∏∏ x1', status: 'approved', date: '08:45' },
            ],
            // ‡πÄ‡∏û‡∏¥‡πà‡∏° Damage Report ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£
            damages: [
                { id: 'D-01', item: '‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå 3x3', issue: '‡∏ú‡πâ‡∏≤‡πÉ‡∏ö‡∏Ç‡∏≤‡∏î', reporter: '‡∏ä‡∏∏‡∏°‡∏ä‡∏ô 70 ‡πÑ‡∏£‡πà', status: '‡∏£‡∏≠‡∏ã‡πà‡∏≠‡∏°' },
                { id: 'D-02', item: '‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô', issue: '‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î', reporter: '‡∏ù‡πà‡∏≤‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô', status: '‡∏™‡πà‡∏á‡∏®‡∏π‡∏ô‡∏¢‡πå' },
                { id: 'D-03', item: '‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ', issue: '‡∏Ç‡∏≤‡∏´‡∏±‡∏Å', reporter: '‡∏á‡∏≤‡∏ô‡∏Å‡∏ß‡∏≤‡∏î', status: '‡πÅ‡∏ó‡∏á‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢' },
            ]
        };

        let STATE = { role: 'user', currentTab: 'home', cart: [], currentCategory: 'all', searchQuery: '' };

        window.onload = () => {
            setInterval(() => document.getElementById('clock').innerText = moment().format('HH:mm'), 1000);
            switchRole('user');
        };

        // --- NAVIGATION & ROLE ---
        function switchRole(role) {
            STATE.role = role;
            // Default tabs per role
            if(role === 'user') STATE.currentTab = 'home';
            else if(role === 'staff') STATE.currentTab = 'dash';
            else if(role === 'admin') STATE.currentTab = 'stock'; // Admin ‡πÄ‡∏ô‡πâ‡∏ô‡∏î‡∏π‡∏Ç‡∏≠‡∏á
            else STATE.currentTab = 'overview';

            // Update UI
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.role-btn[onclick="switchRole('${role}')"]`).classList.add('active');

            const badge = document.getElementById('role-badge');
            const title = document.getElementById('header-title');
            const adminBtn = document.getElementById('admin-action-btn');
            const profileBtn = document.getElementById('profile-btn');

            if(role === 'user') {
                badge.className = "text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-600 font-bold";
                badge.innerText = "USER";
                title.innerText = "‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏û‡∏±‡∏™‡∏î‡∏∏";
                adminBtn.classList.add('hidden');
                profileBtn.classList.remove('hidden');
            } else if(role === 'staff') {
                badge.className = "text-[10px] px-2 py-0.5 rounded-full bg-green-100 text-green-600 font-bold";
                badge.innerText = "STAFF";
                title.innerText = "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏™‡∏î‡∏∏";
                adminBtn.classList.add('hidden');
                profileBtn.classList.remove('hidden');
            } else if(role === 'admin') {
                badge.className = "text-[10px] px-2 py-0.5 rounded-full bg-orange-100 text-orange-600 font-bold";
                badge.innerText = "ADMIN";
                title.innerText = "‡∏Ñ‡∏•‡∏±‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏";
                adminBtn.classList.remove('hidden'); // Admin ‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏° +
                profileBtn.classList.add('hidden');
            } else {
                badge.className = "text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-600 font-bold";
                badge.innerText = "EXECUTIVE";
                title.innerText = "Dashboard";
                adminBtn.classList.add('hidden');
                profileBtn.classList.add('hidden');
            }

            closeLineApp();
            renderView();
        }

        function renderView() {
            renderTabs();
            const container = document.getElementById('main-view');
            container.innerHTML = ''; 

            if(STATE.role === 'user') {
                if(STATE.currentTab === 'home') renderUserHome(container);
                else if(STATE.currentTab === 'cart') renderUserCart(container);
                else if(STATE.currentTab === 'status') renderUserStatus(container);
            } else if(STATE.role === 'staff') {
                if(STATE.currentTab === 'dash') renderStaffDash(container);
                else if(STATE.currentTab === 'tasks') renderStaffTasks(container);
                else if(STATE.currentTab === 'handover') renderStaffHandover(container);
                else if(STATE.currentTab === 'scan') renderStaffScan(container);
            } else if(STATE.role === 'admin') {
                if(STATE.currentTab === 'stock') renderAdminStock(container);
                else if(STATE.currentTab === 'users') renderAdminUsers(container);
            } else {
                renderExecDash(container);
            }
        }

        function renderTabs() {
            const nav = document.getElementById('tab-bar');
            let tabs = [];
            const pendingReq = DB.requests.filter(r=>r.status==='pending').length;
            const approvedReq = DB.requests.filter(r=>r.status==='approved').length;

            if(STATE.role === 'user') {
                tabs = [
                    { id: 'home', icon: 'fa-home', name: '‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å' },
                    { id: 'cart', icon: 'fa-shopping-basket', name: '‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤', badge: STATE.cart.length },
                    { id: 'status', icon: 'fa-clipboard-list', name: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞' }
                ];
            } else if(STATE.role === 'staff') {
                tabs = [
                    { id: 'dash', icon: 'fa-chart-pie', name: '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°' },
                    { id: 'tasks', icon: 'fa-bell', name: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', badge: pendingReq },
                    { id: 'handover', icon: 'fa-box-open', name: '‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö', badge: approvedReq },
                    { id: 'scan', icon: 'fa-qrcode', name: '‡∏™‡πÅ‡∏Å‡∏ô' }
                ];
            } else if(STATE.role === 'admin') {
                tabs = [ 
                    { id: 'stock', icon: 'fa-boxes', name: '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á' },
                    { id: 'users', icon: 'fa-users-cog', name: '‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' }
                ];
            } else {
                tabs = [{ id: 'overview', icon: 'fa-chart-line', name: 'Report & Stats' }];
            }

            nav.innerHTML = tabs.map(t => `
                <div onclick="STATE.currentTab='${t.id}'; renderView()" class="tab-item ${STATE.currentTab === t.id ? 'active' : ''} relative">
                    <i class="fas ${t.icon}"></i><span>${t.name}</span>
                    ${t.badge ? `<span class="absolute top-1 right-8 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center border-2 border-white font-bold">${t.badge}</span>` : ''}
                </div>
            `).join('');
        }

        // ===========================================
        // USER VIEWS
        // ===========================================
        function renderUserHome(container) {
            const categories = [ {id:'all',n:'‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',i:'fa-th'}, {id:'fur',n:'‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏Ø',i:'fa-chair'}, {id:'tech',n:'‡πÑ‡∏≠‡∏ó‡∏µ',i:'fa-laptop'}, {id:'audio',n:'‡πÄ‡∏™‡∏µ‡∏¢‡∏á',i:'fa-microphone'}, {id:'out',n:'‡∏™‡∏ô‡∏≤‡∏°',i:'fa-campground'}, {id:'traf',n:'‡∏à‡∏£‡∏≤‡∏à‡∏£',i:'fa-traffic-light'}, {id:'tool',n:'‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠',i:'fa-tools'} ];
            
            const filtered = DB.assets.filter(a => (STATE.currentCategory === 'all' || a.cat === STATE.currentCategory) && a.name.includes(STATE.searchQuery));

            container.innerHTML = `
                <div class="p-4 fade-in">
                    <div class="relative mb-4">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400 text-sm"></i>
                        <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå..." oninput="STATE.searchQuery=this.value; renderView()" class="w-full bg-white border border-slate-200 rounded-xl py-2.5 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm">
                    </div>
                    <div class="flex gap-2 overflow-x-auto pb-4 no-scrollbar">
                        ${categories.map(c => `<button onclick="STATE.currentCategory='${c.id}'; renderView()" class="${STATE.currentCategory === c.id ? 'bg-slate-800 text-white shadow-md' : 'bg-white text-slate-600 border border-slate-200'} px-4 py-2 rounded-full text-xs font-semibold whitespace-nowrap transition-all"><i class="fas ${c.icon}"></i> ${c.n}</button>`).join('')}
                    </div>
                    <div class="grid grid-cols-2 gap-4 pb-20">
                        ${filtered.map(item => {
                            const isOut = item.available <= 0;
                            return `
                                <div onclick="${isOut ? '' : `addToCartLogic(${item.id})`}" class="bg-white rounded-2xl p-3 shadow-sm border border-slate-100 relative active:scale-95 transition-all cursor-pointer ${isOut ? 'opacity-60 grayscale' : ''}">
                                    ${item.badge ? `<div class="absolute top-2 left-2 ${item.badge==='Hot'?'bg-red-500':'bg-blue-500'} text-white text-[9px] px-2 py-0.5 rounded font-bold z-10 shadow-sm">${item.badge}</div>` : ''}
                                    <div class="h-28 bg-slate-50 rounded-xl flex items-center justify-center text-5xl mb-3">${item.img}</div>
                                    <h4 class="font-bold text-sm text-slate-800 line-clamp-1">${item.name}</h4>
                                    <div class="flex justify-between items-center mt-2">
                                        <span class="text-xs ${isOut ? 'text-red-500' : 'text-slate-500'}">${isOut ? '‡∏´‡∏°‡∏î' : `‡∏ß‡πà‡∏≤‡∏á ${item.available}`}</span>
                                        <button class="w-7 h-7 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center"><i class="fas fa-plus text-xs"></i></button>
                                    </div>
                                </div>
                            `
                        }).join('')}
                    </div>
                </div>`;
        }

        function addToCartLogic(id) {
            const item = DB.assets.find(a => a.id === id);
            Swal.fire({
                title: item.name, html: `‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${item.available}`, input: 'number', inputValue: 1, showCancelButton: true, confirmButtonText: '‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤', confirmButtonColor: '#2563eb'
            }).then((res) => {
                if (res.isConfirmed) {
                    const qty = parseInt(res.value);
                    const exist = STATE.cart.find(c => c.id === id);
                    if(exist) exist.qty += qty; else STATE.cart.push({...item, qty});
                    renderView();
                    Swal.fire({icon: 'success', title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß', toast: true, position: 'top', timer: 1000, showConfirmButton: false});
                }
            });
        }

        function renderUserCart(container) {
            if(STATE.cart.length === 0) return container.innerHTML = `<div class="h-full flex flex-col items-center justify-center text-slate-400"><i class="fas fa-shopping-basket text-4xl mb-2"></i><p>‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p><button onclick="STATE.currentTab='home'; renderView()" class="mt-4 px-6 py-2 bg-blue-50 text-blue-600 rounded-full text-xs font-bold">‡πÑ‡∏õ‡∏ä‡πâ‡∏≠‡∏õ‡∏Å‡∏±‡∏ô</button></div>`;
            container.innerHTML = `
                <div class="p-4 fade-in pb-20">
                    <h2 class="font-bold mb-4 text-slate-800">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤ (${STATE.cart.length})</h2>
                    <div class="space-y-3 mb-6">${STATE.cart.map((i,idx) => `<div class="bg-white p-3 rounded-xl border border-slate-100 flex items-center gap-3 shadow-sm"><div class="text-3xl w-12 text-center bg-slate-50 rounded-lg py-1">${i.img}</div><div class="flex-1"><div class="font-bold text-sm text-slate-800">${i.name}</div><div class="text-xs text-slate-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${i.qty}</div></div><button onclick="STATE.cart.splice(${idx},1); renderView()" class="text-red-500 ml-2 bg-red-50 w-8 h-8 rounded-full flex items-center justify-center"><i class="fas fa-trash text-xs"></i></button></div>`).join('')}</div>
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm mb-4">
                        <label class="text-[10px] uppercase font-bold text-slate-400">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</label>
                        <input type="date" class="w-full border-b border-slate-200 py-2 text-sm outline-none">
                    </div>
                    <button onclick="submitOrder()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-500/30 active:scale-95 transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
                </div>`;
        }

        function submitOrder() {
            const reqId = 'R-' + Math.floor(Math.random()*9000+1000);
            DB.requests.unshift({ id: reqId, user: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢', items: STATE.cart.map(i=>`${i.name} x${i.qty}`).join(', '), status: 'pending', date: 'Now' });
            STATE.cart = []; STATE.currentTab = 'status'; renderView();
            setTimeout(() => triggerNotification(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${reqId} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'req'), 800);
        }

        function renderUserStatus(container) {
            container.innerHTML = `
                <div class="p-4 fade-in pb-20"><h2 class="font-bold mb-4 text-slate-800">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</h2><div class="space-y-3">
                ${DB.requests.map(r => {
                    let badge = r.status==='approved' ? 'bg-green-100 text-green-600' : (r.status==='active' ? 'bg-blue-100 text-blue-600' : 'bg-orange-100 text-orange-600');
                    let statusTxt = r.status==='approved' ? '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á' : (r.status==='active' ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö');
                    return `
                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                        <div class="flex justify-between mb-2"><span class="font-mono text-xs text-slate-400 font-bold">${r.id}</span><span class="px-2 py-0.5 rounded text-[10px] font-bold ${badge}">${statusTxt}</span></div>
                        <div class="text-xs text-slate-700 mb-3 bg-slate-50 p-2 rounded">${r.items}</div>
                        ${r.status==='approved' ? `<button onclick="Swal.fire('QR Code','‡∏¢‡∏∑‡πà‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô','info')" class="w-full bg-green-500 text-white py-2 rounded-lg text-xs font-bold shadow-sm shadow-green-200"><i class="fas fa-qrcode mr-1"></i> ‡πÅ‡∏™‡∏î‡∏á QR ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</button>` : ''}
                    </div>`
                }).join('')}
                </div></div>`;
        }

        // ===========================================
        // STAFF VIEWS (Flow Fix: Approve -> Handover)
        // ===========================================
        function renderStaffDash(container) {
            const approvedCount = DB.requests.filter(r=>r.status==='approved').length;
            const pendingCount = DB.requests.filter(r=>r.status==='pending').length;
            container.innerHTML = `
                <div class="p-4 fade-in">
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <div onclick="STATE.currentTab='handover'; renderView()" class="bg-blue-600 rounded-2xl p-4 text-white shadow-lg relative overflow-hidden cursor-pointer active:scale-95 transition">
                            <i class="fas fa-box-open absolute -right-2 -bottom-2 text-6xl opacity-20"></i>
                            <div class="text-3xl font-bold">${approvedCount}</div><div class="text-xs opacity-90 font-medium">‡∏£‡∏≠‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö (‡∏Å‡∏î‡πÄ‡∏•‡∏¢)</div>
                        </div>
                        <div onclick="STATE.currentTab='tasks'; renderView()" class="bg-orange-500 rounded-2xl p-4 text-white shadow-lg relative overflow-hidden cursor-pointer active:scale-95 transition">
                            <i class="fas fa-clock absolute -right-2 -bottom-2 text-6xl opacity-20"></i>
                            <div class="text-3xl font-bold">${pendingCount}</div><div class="text-xs opacity-90 font-medium">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                        </div>
                    </div>
                    <h3 class="font-bold text-sm text-slate-700 mb-3 px-1">‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πà‡∏ß‡∏ô</h3>
                    <div class="grid grid-cols-3 gap-3">
                        <div onclick="STATE.currentTab='scan'; renderView()" class="bg-white p-3 rounded-2xl border flex flex-col items-center gap-2 cursor-pointer hover:bg-slate-50"><div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600"><i class="fas fa-qrcode"></i></div><span class="text-[10px] font-bold text-slate-600">‡∏™‡πÅ‡∏Å‡∏ô</span></div>
                        <div class="bg-white p-3 rounded-2xl border flex flex-col items-center gap-2 cursor-pointer hover:bg-slate-50"><div class="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center text-green-600"><i class="fas fa-dolly"></i></div><span class="text-[10px] font-bold text-slate-600">‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô</span></div>
                        <div class="bg-white p-3 rounded-2xl border flex flex-col items-center gap-2 cursor-pointer hover:bg-slate-50"><div class="w-10 h-10 rounded-full bg-red-100 flex items-center justify-center text-red-600"><i class="fas fa-wrench"></i></div><span class="text-[10px] font-bold text-slate-600">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</span></div>
                    </div>
                </div>`;
        }

        function renderStaffTasks(container) {
            const pendings = DB.requests.filter(r=>r.status==='pending');
            container.innerHTML = `<div class="p-4 fade-in pb-20"><h2 class="font-bold mb-4">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (${pendings.length})</h2>
            ${pendings.length===0 ? '<div class="text-center text-slate-400 mt-10"><i class="fas fa-check-circle text-4xl mb-2 text-green-400"></i><p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</p></div>' : pendings.map(req => `
                <div class="bg-white p-4 rounded-xl border-l-4 border-orange-500 shadow-sm mb-3">
                    <div class="flex justify-between mb-2"><h4 class="font-bold text-sm text-slate-800">${req.user}</h4><span class="text-[10px] text-slate-400 font-mono">${req.date}</span></div>
                    <div class="bg-orange-50 p-2 text-xs mb-3 border border-orange-100 text-orange-800 rounded">${req.items}</div>
                    <button onclick="approveRequest('${req.id}')" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded text-xs font-bold shadow-sm transition-colors">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                </div>`).join('')}</div>`;
        }

        function approveRequest(id) {
            Swal.fire({title:'‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?', icon:'question', showCancelButton:true, confirmButtonColor:'#22c55e', confirmButtonText:'‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'}).then(res=>{
                if(res.isConfirmed) {
                    DB.requests.find(r=>r.id===id).status = 'approved';
                    renderView();
                    setTimeout(()=>triggerNotification(`‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ${id} ‡πÅ‡∏•‡πâ‡∏ß`, 'approve'), 500);
                }
            });
        }

        function renderStaffHandover(container) {
            const approved = DB.requests.filter(r=>r.status==='approved');
            container.innerHTML = `<div class="p-4 fade-in pb-20"><h2 class="font-bold mb-4">‡∏£‡∏≠‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö (${approved.length})</h2>
            ${approved.length===0 ? '<div class="text-center text-slate-400 mt-10"><p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</p></div>' : approved.map(req => `
                <div class="bg-white p-4 rounded-xl border-l-4 border-blue-600 shadow-sm mb-3">
                    <div class="flex justify-between mb-2"><h4 class="font-bold text-sm text-blue-800">${req.user}</h4><span class="text-[10px] text-slate-400">${req.id}</span></div>
                    <div class="bg-blue-50 p-2 text-xs mb-3 text-blue-800 rounded border border-blue-100">${req.items}</div>
                    <button onclick="performHandover('${req.id}')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded text-xs font-bold shadow-sm transition-colors"><i class="fas fa-qrcode"></i> ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</button>
                </div>`).join('')}</div>`;
        }

        function performHandover(id) {
            const container = document.getElementById('main-view');
            container.innerHTML = `
                <div class="h-full bg-black relative flex flex-col items-center justify-center">
                    <img src="https://images.unsplash.com/photo-1550751827-4bd374c3f58b?w=800&q=80" class="absolute inset-0 w-full h-full object-cover opacity-50">
                    <div class="w-64 h-64 border-2 border-green-400 rounded-3xl relative z-10"><div class="w-full h-0.5 bg-green-500 absolute top-1/2 animate-pulse shadow-[0_0_15px_rgba(34,197,94,1)]"></div></div>
                    <div class="z-10 mt-8 text-white font-bold animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô...</div>
                </div>`;
            
            setTimeout(() => {
                DB.requests.find(r=>r.id===id).status = 'active';
                Swal.fire({title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', text: '‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö‡∏û‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', icon: 'success'});
                STATE.currentTab = 'handover';
                renderView();
            }, 1500);
        }

        function renderStaffScan(container) {
            container.innerHTML = `<div class="h-full flex items-center justify-center bg-slate-900 text-white"><div class="text-center"><i class="fas fa-qrcode text-6xl mb-4 text-blue-500"></i><p>‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</p></div></div>`;
        }

        // ===========================================
        // ADMIN VIEWS (Added: Add Item Function)
        // ===========================================
        function renderAdminStock(container) {
            container.innerHTML = `
                <div class="p-4 fade-in pb-20">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="font-bold text-slate-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á (${DB.assets.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)</h2>
                    </div>
                    <div class="space-y-2">
                        ${DB.assets.map(a => `
                            <div class="bg-white p-2 rounded-xl border border-slate-100 shadow-sm flex items-center gap-3">
                                <div class="w-10 h-10 bg-slate-50 rounded-lg flex items-center justify-center text-xl">${a.img}</div>
                                <div class="flex-1 min-w-0">
                                    <div class="font-bold text-sm text-slate-800 truncate">${a.name}</div>
                                    <div class="text-[10px] text-slate-400 uppercase">${a.cat}</div>
                                </div>
                                <div class="flex items-center gap-2 bg-slate-50 rounded-lg p-1">
                                    <button onclick="updateStock(${a.id}, -1)" class="w-6 h-6 bg-white rounded shadow-sm text-slate-600 font-bold hover:text-red-500">-</button>
                                    <span class="text-xs font-bold w-6 text-center text-slate-700">${a.stock}</span>
                                    <button onclick="updateStock(${a.id}, 1)" class="w-6 h-6 bg-white rounded shadow-sm text-blue-600 font-bold hover:text-blue-700">+</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function adminAddAsset() {
            Swal.fire({
                title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà',
                html: `
                    <input id="swal-name" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                    <input id="swal-stock" type="number" class="swal2-input" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô">
                    <select id="swal-cat" class="swal2-input">
                        <option value="fur">‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏ô‡∏¥‡πÄ‡∏à‡∏≠‡∏£‡πå</option>
                        <option value="tech">‡πÑ‡∏≠‡∏ó‡∏µ</option>
                        <option value="out">‡∏™‡∏ô‡∏≤‡∏°</option>
                    </select>
                `,
                confirmButtonText: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
                confirmButtonColor: '#2563eb',
                preConfirm: () => {
                    return [
                        document.getElementById('swal-name').value,
                        document.getElementById('swal-stock').value,
                        document.getElementById('swal-cat').value
                    ]
                }
            }).then((result) => {
                if(result.isConfirmed) {
                    const [name, stock, cat] = result.value;
                    if(!name || !stock) return;
                    DB.assets.unshift({
                        id: Date.now(), name: name, stock: parseInt(stock), available: parseInt(stock), img: 'üì¶', cat: cat, badge: 'New'
                    });
                    renderView();
                    Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            });
        }

        function updateStock(id, delta) {
            const asset = DB.assets.find(a=>a.id===id);
            asset.stock += delta;
            if(asset.stock < 0) asset.stock = 0;
            renderView();
        }

        function renderAdminUsers(container) {
            container.innerHTML = `<div class="p-4 fade-in pb-20"><h2 class="font-bold mb-4 text-slate-800">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</h2><div class="space-y-3">${DB.users.map(u => `
                <div class="bg-white p-3 rounded-xl border shadow-sm flex justify-between items-center">
                    <div class="flex items-center gap-3"><div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-slate-500">${u.name[0]}</div><div><div class="font-bold text-sm text-slate-800">${u.name}</div><div class="text-[10px] text-slate-500">${u.role}</div></div></div>
                    <div onclick="u.status=!u.status; renderView()" class="w-12 h-6 rounded-full p-1 cursor-pointer transition-colors ${u.status?'bg-green-500':'bg-slate-300'}"><div class="w-4 h-4 bg-white rounded-full shadow transition-transform ${u.status?'translate-x-6':''}"></div></div>
                </div>`).join('')}</div></div>`;
        }

        // ===========================================
        // EXEC VIEW (Restored & Enhanced)
        // ===========================================
        let chartInstance = null;
        function renderExecDash(container) {
            container.innerHTML = `
                <div class="p-4 fade-in pb-20">
                    <div class="bg-gradient-to-br from-indigo-900 to-purple-900 rounded-2xl p-5 text-white shadow-xl mb-6 relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white/5 rounded-full -mr-10 -mt-10"></div>
                        <h2 class="text-[10px] font-bold text-indigo-200 mb-1 uppercase tracking-widest">Social Impact (Month)</h2>
                        <div class="flex items-end gap-3 mb-4"><span class="text-4xl font-bold">1,420</span><span class="text-xs text-indigo-200 mb-1">Transactions</span></div>
                        <div class="grid grid-cols-2 gap-4 text-xs border-t border-indigo-700/50 pt-3">
                            <div><span class="block text-indigo-300">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡∏ä‡∏∏‡∏°‡∏ä‡∏ô</span><span class="font-bold text-lg">‡∏ø 1.2M</span></div>
                            <div><span class="block text-indigo-300">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå</span><span class="font-bold text-lg">~3.5k</span></div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-2xl shadow-sm border border-slate-100 mb-6">
                        <h3 class="font-bold text-sm text-slate-700 mb-4 flex items-center gap-2"><i class="fas fa-chart-pie text-blue-500"></i> ‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Utilization)</h3>
                        <div class="h-48 relative">
                            <canvas id="execChart"></canvas>
                        </div>
                    </div>

                    <h3 class="font-bold text-sm text-slate-700 mb-2 px-1 flex items-center gap-2"><i class="fas fa-tools text-red-500"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</h3>
                    <div class="bg-white rounded-2xl border border-slate-100 overflow-hidden shadow-sm">
                        <table class="w-full text-left text-xs">
                            <thead class="bg-slate-50 text-slate-500 font-bold border-b border-slate-100">
                                <tr><th class="p-3">‡∏û‡∏±‡∏™‡∏î‡∏∏</th><th class="p-3">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</th><th class="p-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th></tr>
                            </thead>
                            <tbody class="divide-y divide-slate-100">
                                ${DB.damages.map(d => `
                                    <tr>
                                        <td class="p-3 text-slate-700 font-bold">${d.item}<div class="text-[9px] text-slate-400 font-normal">${d.reporter}</div></td>
                                        <td class="p-3 text-red-500 font-medium">${d.issue}</td>
                                        <td class="p-3"><span class="bg-slate-100 text-slate-600 px-2 py-1 rounded text-[9px] font-bold">${d.status}</span></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <div class="p-2 text-center text-[10px] text-blue-500 font-bold border-t border-slate-100 cursor-pointer">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    </div>
                </div>
            `;
            
            // Re-init Chart
            setTimeout(() => {
                const ctx = document.getElementById('execChart');
                if(!ctx) return;
                
                if(chartInstance) chartInstance.destroy();
                chartInstance = new Chart(ctx.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['Furniture', 'Tech', 'Outdoor', 'Audio', 'Traffic'],
                        datasets: [{
                            data: [350, 120, 200, 80, 150],
                            backgroundColor: ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'],
                            borderWidth: 0,
                            hoverOffset: 10
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                        plugins: { legend: { position: 'right', labels: { usePointStyle: true, boxWidth: 6, font: {size:10} } } } 
                    }
                });
            }, 100);
        }

        // --- UTILS ---
        function triggerNotification(text, type) {
            const n = document.getElementById('notification');
            document.getElementById('notif-text').innerText = text;
            n.classList.add('show');
            setTimeout(() => n.classList.remove('show'), 4000);
            
            const chat = document.getElementById('chat-history');
            const time = moment().format('HH:mm');
            
            if(type === 'req') {
                chat.innerHTML += `<div class="self-start bg-white rounded-xl rounded-tl-none shadow-sm max-w-[80%] mb-3 overflow-hidden fade-in"><div class="bg-slate-800 text-white p-2 text-xs font-bold">New Request</div><div class="p-2"><p class="text-xs text-gray-700">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡∏£‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p></div></div>`;
            } else if(type === 'approve') {
                chat.innerHTML += `<div class="self-start bg-white rounded-xl rounded-tl-none shadow-sm max-w-[80%] mb-3 p-2 fade-in"><div class="text-green-600 font-bold text-xs mb-1">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</div><p class="text-xs text-gray-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</p><div class="text-[9px] text-gray-400 text-right mt-1">${time}</div></div>`;
            }
        }
        function openLineApp() { document.getElementById('app-line').style.display = 'flex'; document.getElementById('notification').classList.remove('show'); }
        function closeLineApp() { document.getElementById('app-line').style.display = 'none'; }
    </script>
</body>
</html>
