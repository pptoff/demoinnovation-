<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Klongtoey Smart Asset - Master Demo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Sarabun', sans-serif;
            background: #111827; /* Dark BG for presentation focus */
            height: 100vh;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* --- DEVICE FRAME (iPhone 14 Pro Style) --- */
        .device-frame {
            width: 400px;
            height: 850px;
            background: black;
            border-radius: 50px;
            border: 12px solid #333;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Dynamic Island */
        .dynamic-island {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 35px;
            background: black;
            border-radius: 20px;
            z-index: 999;
        }

        /* --- OS SIMULATION LAYERS --- */
        .screen-layer {
            flex: 1;
            background: #f3f4f6;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* Fake Status Bar */
        .status-bar {
            height: 44px;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            font-weight: 600;
            color: #000;
            background: rgba(255,255,255,0.8);
            backdrop-filter: blur(5px);
            z-index: 100;
        }

        /* Notification Banner */
        .notification-banner {
            position: absolute;
            top: -100px;
            left: 10px;
            right: 10px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            gap: 12px;
            transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }
        .notification-banner.show { top: 55px; }

        /* --- APP: SMART ASSET UI --- */
        #app-smart-asset { height: 100%; display: flex; flex-direction: column; }
        .app-content { flex: 1; overflow-y: auto; padding-bottom: 80px; }
        .app-content::-webkit-scrollbar { width: 0; }
        
        /* Bottom Tab Bar */
        .tab-bar {
            height: 70px;
            background: white;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: 20px; /* Safe area */
        }
        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 10px;
            color: #9ca3af;
            transition: 0.2s;
            cursor: pointer;
        }
        .tab-item.active { color: #2563eb; transform: translateY(-2px); }
        .tab-item i { font-size: 20px; margin-bottom: 4px; }

        /* --- APP: LINE CHAT UI --- */
        #app-line { 
            height: 100%; 
            background: #849ebf; 
            display: none; 
            flex-direction: column; 
        }
        .chat-header { background: #2c3e50; color: white; padding: 15px; display: flex; align-items: center; gap: 10px; }
        .chat-area { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        
        .chat-bubble {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 14px;
            position: relative;
            animation: fadeIn 0.3s;
        }
        .chat-bubble.left { background: white; color: black; align-self: flex-start; border-top-left-radius: 2px; }
        .chat-bubble.right { background: #92d050; color: black; align-self: flex-end; border-top-right-radius: 2px; }

        /* Flex Message Simulation */
        .flex-msg { background: white; border-radius: 10px; overflow: hidden; width: 240px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .flex-header { background: #2563eb; color: white; padding: 10px; font-weight: bold; }
        .flex-body { padding: 15px; }
        .flex-row { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px; }
        .flex-btn { display: block; width: 100%; padding: 10px; text-align: center; color: #2563eb; border-top: 1px solid #eee; font-weight: bold; font-size: 14px; cursor: pointer; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Floating Role Switcher */
        .role-switcher {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            border-radius: 30px;
            padding: 5px;
            display: flex;
            gap: 5px;
            z-index: 2000;
        }
        .role-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .role-btn:hover { transform: scale(1.1); }
        .role-btn.active { box-shadow: 0 0 10px white; }

        /* Utility */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="device-frame">
        <div class="dynamic-island"></div>
        
        <div class="status-bar">
            <span id="clock">12:00</span>
            <div class="flex gap-1.5">
                <i class="fas fa-signal"></i>
                <i class="fas fa-wifi"></i>
                <i class="fas fa-battery-full"></i>
            </div>
        </div>

        <div id="notification" class="notification-banner" onclick="openLineApp()">
            <div class="w-10 h-10 bg-green-500 rounded-xl flex items-center justify-center text-white text-xl">
                <i class="fab fa-line"></i>
            </div>
            <div class="flex-1">
                <div class="flex justify-between items-center mb-1">
                    <span class="font-bold text-xs">LINE ‚Ä¢ Now</span>
                </div>
                <div class="font-bold text-sm">Klongtoey Smart Asset</div>
                <div class="text-xs text-gray-500" id="notif-text">‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà...</div>
            </div>
        </div>

        <div class="screen-layer">
            
            <div id="app-smart-asset">
                <header class="bg-white px-4 py-3 shadow-sm flex justify-between items-center z-10">
                    <div>
                        <h1 class="font-bold text-lg text-gray-800" id="header-title">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏</h1>
                        <span class="text-[10px] px-2 py-0.5 rounded-full bg-gray-100 text-gray-500" id="role-badge">User</span>
                    </div>
                    <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden border border-gray-300">
                        <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Profile">
                    </div>
                </header>

                <div class="app-content" id="main-view">
                    </div>

                <div class="tab-bar" id="tab-bar">
                    </div>
            </div>

            <div id="app-line">
                <div class="chat-header">
                    <i class="fas fa-chevron-left cursor-pointer" onclick="closeLineApp()"></i>
                    <h3 class="font-bold">Klongtoey Smart Asset (Bot)</h3>
                </div>
                <div class="chat-area" id="chat-history">
                    </div>
                <div class="bg-white p-3 flex gap-2 items-center">
                    <i class="fas fa-plus text-gray-400"></i>
                    <i class="fas fa-camera text-gray-400"></i>
                    <i class="fas fa-image text-gray-400"></i>
                    <input type="text" placeholder="Aa" class="flex-1 bg-gray-100 rounded-full px-3 py-1.5 text-sm outline-none" disabled>
                    <i class="fas fa-microphone text-gray-400"></i>
                </div>
            </div>

        </div>
    </div>

    <div class="role-switcher">
        <button class="role-btn bg-blue-500 active" onclick="setRole('user')" title="User"><i class="fas fa-user"></i></button>
        <button class="role-btn bg-green-500" onclick="setRole('staff')" title="Staff"><i class="fas fa-id-badge"></i></button>
        <button class="role-btn bg-orange-500" onclick="setRole('admin')" title="Admin"><i class="fas fa-tools"></i></button>
        <button class="role-btn bg-purple-500" onclick="setRole('exec')" title="Executive"><i class="fas fa-chart-pie"></i></button>
    </div>

    <script>
        // --- REALTIME CLOCK ---
        setInterval(() => {
            document.getElementById('clock').innerText = moment().format('HH:mm');
        }, 1000);

        // --- DATABASE (MOCK) ---
        const DB = {
            users: [
                { id: 'U1', name: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢', role: 'user', dept: '‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏´‡∏°‡∏π‡πà 1', status: 'active' },
                { id: 'U2', name: '‡∏ô.‡∏™.‡πÉ‡∏à‡∏î‡∏µ', role: 'staff', dept: '‡∏ù‡πà‡∏≤‡∏¢‡∏û‡∏±‡∏™‡∏î‡∏∏', status: 'active' },
                { id: 'U3', name: '‡∏ô‡∏≤‡∏¢ A (‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥)', role: 'user', dept: '‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô', status: 'pending' }
            ],
            assets: [
                { id: 1, name: "‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å (‡∏Ç‡∏≤‡∏ß)", stock: 500, available: 450, img: "ü™ë", cat: "furniture", pop: 95 },
                { id: 2, name: "‡πÇ‡∏ï‡πä‡∏∞‡∏û‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≤‡∏ß 1.5‡∏°.", stock: 100, available: 80, img: "üü´", cat: "furniture", pop: 80 },
                { id: 3, name: "‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏ú‡πâ‡∏≤‡πÉ‡∏ö 3x3m", stock: 20, available: 2, img: "‚õ∫", cat: "outdoor", pop: 99 },
                { id: 4, name: "‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ‡πÄ‡∏ï‡∏≠‡∏£‡πå Epson", stock: 5, available: 4, img: "üìΩÔ∏è", cat: "tech", pop: 60 },
                { id: 5, name: "‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÑ‡∏£‡πâ‡∏™‡∏≤‡∏¢", stock: 10, available: 10, img: "üé§", cat: "audio", pop: 70 },
                { id: 6, name: "‡∏ä‡∏∏‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏ô‡∏≤‡∏°", stock: 4, available: 0, img: "üîä", cat: "audio", pop: 85 },
                { id: 7, name: "‡πÅ‡∏ú‡∏á‡∏Å‡∏±‡πâ‡∏ô‡∏à‡∏£‡∏≤‡∏à‡∏£", stock: 50, available: 40, img: "üöß", cat: "tool", pop: 30 },
                { id: 8, name: "‡∏û‡∏±‡∏î‡∏•‡∏°‡πÑ‡∏≠‡∏ô‡πâ‡∏≥", stock: 10, available: 8, img: "üí®", cat: "outdoor", pop: 50 }
            ],
            requests: [
                { id: 'R-099', user: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢', items: [{name: '‡πÄ‡∏ï‡πá‡∏ô‡∏ó‡πå‡∏ú‡πâ‡∏≤‡πÉ‡∏ö 3x3m', qty: 2}], status: 'approved', date: 'Yesterday' },
            ],
            logs: [
                { time: '10:00', actor: 'System', action: 'Auto-backup completed' },
                { time: '09:45', actor: '‡∏ô.‡∏™.‡πÉ‡∏à‡∏î‡∏µ', action: 'Approved R-099' }
            ]
        };

        let STATE = {
            role: 'user',
            cart: [],
            currentApp: 'asset' // asset, line
        };

        // --- CORE FUNCTIONS ---

        function setRole(role) {
            STATE.role = role;
            
            // Update UI Badges
            document.querySelectorAll('.role-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.role-btn[onclick="setRole('${role}')"]`).classList.add('active');
            
            const badge = document.getElementById('role-badge');
            const title = document.getElementById('header-title');
            
            if(role === 'user') { badge.className = "text-[10px] px-2 py-0.5 rounded-full bg-blue-100 text-blue-600"; badge.innerText = "User"; title.innerText = "‡∏¢‡∏∑‡∏°‡∏û‡∏±‡∏™‡∏î‡∏∏"; }
            else if(role === 'staff') { badge.className = "text-[10px] px-2 py-0.5 rounded-full bg-green-100 text-green-600"; badge.innerText = "Staff L2"; title.innerText = "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà"; }
            else if(role === 'admin') { badge.className = "text-[10px] px-2 py-0.5 rounded-full bg-orange-100 text-orange-600"; badge.innerText = "Admin"; title.innerText = "‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö"; }
            else { badge.className = "text-[10px] px-2 py-0.5 rounded-full bg-purple-100 text-purple-600"; badge.innerText = "Executive"; title.innerText = "‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£"; }

            // Reset View
            closeLineApp();
            renderTabs();
            // Default views per role
            if(role === 'user') renderUserHome();
            else if(role === 'staff') renderStaffDashboard();
            else if(role === 'admin') renderAdminUsers();
            else renderExecDashboard();
        }

        function triggerNotification(text, type = 'info') {
            const banner = document.getElementById('notification');
            document.getElementById('notif-text').innerText = text;
            banner.classList.add('show');
            
            // Auto hide
            setTimeout(() => { banner.classList.remove('show'); }, 4000);

            // Add to Line Chat History automatically
            addChatMessage('bot', text, type);
        }

        function openLineApp() {
            document.getElementById('app-smart-asset').style.display = 'none';
            document.getElementById('app-line').style.display = 'flex';
            document.getElementById('notification').classList.remove('show');
            STATE.currentApp = 'line';
        }

        function closeLineApp() {
            document.getElementById('app-smart-asset').style.display = 'flex';
            document.getElementById('app-line').style.display = 'none';
            STATE.currentApp = 'asset';
        }

        function addChatMessage(sender, text, type = 'text') {
            const chat = document.getElementById('chat-history');
            let html = '';
            
            if(sender === 'bot') {
                if(type === 'flex-request') {
                    html = `
                        <div class="chat-bubble left p-0 bg-transparent animate__animated animate__fadeInLeft">
                            <div class="flex-msg">
                                <div class="flex-header">üõí ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏¢‡∏∑‡∏°</div>
                                <div class="flex-body">
                                    <div class="font-bold mb-2 text-gray-800">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏û‡∏±‡∏™‡∏î‡∏∏</div>
                                    <div class="flex-row text-gray-500"><span>User:</span><span>${DB.users[0].name}</span></div>
                                    <div class="flex-row text-gray-500"><span>Items:</span><span>${text}</span></div>
                                    <div class="flex-row text-orange-500 font-bold"><span>Status:</span><span>‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span></div>
                                </div>
                                <div class="flex-btn" onclick="closeLineApp()">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏≠‡∏õ</div>
                            </div>
                        </div>`;
                } else if (type === 'flex-approve') {
                    html = `
                        <div class="chat-bubble left p-0 bg-transparent animate__animated animate__fadeInLeft">
                            <div class="flex-msg">
                                <div class="flex-header bg-green-500">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</div>
                                <div class="flex-body">
                                    <div class="font-bold mb-2 text-gray-800">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</div>
                                    <div class="text-xs text-gray-500 mb-2">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</div>
                                </div>
                                <div class="flex-btn text-green-600" onclick="closeLineApp(); setRole('user'); renderUserStatus();">‡πÄ‡∏õ‡∏¥‡∏î QR Code</div>
                            </div>
                        </div>`;
                } else {
                    html = `<div class="chat-bubble left">${text}</div>`;
                }
            } else {
                html = `<div class="chat-bubble right">${text}</div>`;
            }
            
            chat.innerHTML += html;
            chat.scrollTop = chat.scrollHeight;
        }

        function renderTabs() {
            const nav = document.getElementById('tab-bar');
            let html = '';
            
            if (STATE.role === 'user') {
                html = `
                    <div onclick="renderUserHome()" class="tab-item"><i class="fas fa-home"></i>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</div>
                    <div onclick="renderUserCart()" class="tab-item relative">
                        <i class="fas fa-shopping-basket"></i>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
                        ${STATE.cart.length > 0 ? `<div class="absolute top-0 right-8 bg-red-500 text-white rounded-full w-4 h-4 flex items-center justify-center text-[9px]">${STATE.cart.length}</div>` : ''}
                    </div>
                    <div onclick="renderUserStatus()" class="tab-item"><i class="fas fa-tasks"></i>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
                    <div class="tab-item"><i class="fas fa-user"></i>‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</div>
                `;
            } else if (STATE.role === 'staff') {
                html = `
                    <div onclick="renderStaffDashboard()" class="tab-item"><i class="fas fa-chart-pie"></i>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</div>
                    <div onclick="renderStaffTasks()" class="tab-item relative">
                        <i class="fas fa-clipboard-check"></i>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                        ${DB.requests.filter(r => r.status === 'pending').length > 0 ? '<div class="absolute top-0 right-8 w-3 h-3 bg-red-500 rounded-full animate-pulse"></div>' : ''}
                    </div>
                    <div onclick="renderScanner()" class="tab-item text-blue-600"><i class="fas fa-qrcode text-3xl"></i></div>
                    <div class="tab-item"><i class="fas fa-history"></i>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
                `;
            } else if (STATE.role === 'admin') {
                html = `
                    <div onclick="renderAdminUsers()" class="tab-item"><i class="fas fa-users-cog"></i>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</div>
                    <div onclick="renderAdminStock()" class="tab-item"><i class="fas fa-boxes"></i>‡∏Ñ‡∏•‡∏±‡∏á</div>
                    <div class="tab-item"><i class="fas fa-file-alt"></i>Logs</div>
                `;
            } else if (STATE.role === 'exec') {
                html = `
                    <div onclick="renderExecDashboard()" class="tab-item"><i class="fas fa-chart-line"></i>Overview</div>
                    <div class="tab-item"><i class="fas fa-tools"></i>Report</div>
                `;
            }
            nav.innerHTML = html;
        }

        // ==========================================
        // VIEW: USER
        // ==========================================
        function renderUserHome() {
            const main = document.getElementById('main-view');
            let html = `
                <div class="px-4 py-2">
                    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 rounded-2xl p-4 text-white shadow-lg mb-4">
                        <h2 class="font-bold text-lg">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö, ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢</h2>
                        <p class="text-xs opacity-80 mb-2">‡∏ä‡∏∏‡∏°‡∏ä‡∏ô‡∏´‡∏°‡∏π‡πà 1 ‚Ä¢ Credit Score: A</p>
                        <div class="flex gap-2 text-[10px]">
                            <span class="bg-white/20 px-2 py-1 rounded">‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: 100%</span>
                            <span class="bg-white/20 px-2 py-1 rounded">‡∏Ñ‡∏∑‡∏ô‡∏ï‡∏£‡∏á‡πÄ‡∏ß‡∏•‡∏≤: 100%</span>
                        </div>
                    </div>

                    <div class="flex gap-2 overflow-x-auto pb-2 mb-2 no-scrollbar">
                        <button class="px-4 py-1.5 bg-gray-800 text-white rounded-full text-xs whitespace-nowrap">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                        <button class="px-4 py-1.5 bg-gray-100 text-gray-600 border rounded-full text-xs whitespace-nowrap">‡πÄ‡∏ü‡∏≠‡∏£‡πå‡∏ô‡∏¥‡πÄ‡∏à‡∏≠‡∏£‡πå</button>
                        <button class="px-4 py-1.5 bg-gray-100 text-gray-600 border rounded-full text-xs whitespace-nowrap">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>
                    </div>

                    <h3 class="font-bold text-sm text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏™‡∏î‡∏∏</h3>
                    <div class="grid grid-cols-2 gap-3">
            `;

            DB.assets.forEach(item => {
                const isOut = item.available <= 0;
                html += `
                    <div onclick="${isOut ? '' : `addToCart(${item.id})`}" class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm active:scale-95 transition relative overflow-hidden ${isOut ? 'opacity-60 grayscale' : ''}">
                        ${isOut ? '<div class="absolute top-2 right-2 bg-red-500 text-white text-[9px] px-2 py-0.5 rounded font-bold">‡∏´‡∏°‡∏î</div>' : ''}
                        <div class="h-20 bg-gray-50 rounded-lg flex items-center justify-center text-4xl mb-2">${item.img}</div>
                        <h4 class="font-bold text-xs text-gray-800 line-clamp-1">${item.name}</h4>
                        <div class="flex justify-between items-end mt-1">
                            <span class="text-[10px] ${item.available < 5 ? 'text-red-500 font-bold' : 'text-green-600'}">‡∏ß‡πà‡∏≤‡∏á ${item.available}</span>
                            <div class="w-6 h-6 rounded-full bg-blue-50 text-blue-600 flex items-center justify-center font-bold text-xs">+</div>
                        </div>
                    </div>
                `;
            });

            html += `</div></div>`;
            main.innerHTML = html;
        }

        function addToCart(id) {
            const item = DB.assets.find(a => a.id === id);
            
            // SweetAlert for Qty
            Swal.fire({
                title: item.name,
                text: `‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${item.available} ‡∏ä‡∏¥‡πâ‡∏ô`,
                input: 'number',
                inputValue: 1,
                inputAttributes: { min: 1, max: item.available, step: 1 },
                showCancelButton: true,
                confirmButtonText: '‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤',
                confirmButtonColor: '#2563eb'
            }).then((result) => {
                if (result.isConfirmed) {
                    const qty = parseInt(result.value);
                    const existing = STATE.cart.find(c => c.id === id);
                    if(existing) existing.qty += qty;
                    else STATE.cart.push({...item, qty});
                    
                    renderTabs(); // Update badge
                    const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 1500 });
                    Toast.fire({ icon: 'success', title: '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß' });
                }
            });
        }

        function renderUserCart() {
            const main = document.getElementById('main-view');
            if(STATE.cart.length === 0) {
                main.innerHTML = `<div class="h-full flex flex-col items-center justify-center text-gray-400">
                    <i class="fas fa-shopping-basket text-4xl mb-2"></i><p>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</p>
                    <button onclick="renderUserHome()" class="mt-4 text-blue-600 font-bold text-sm">‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á</button>
                </div>`;
                return;
            }

            let html = `<div class="px-4 py-2"><h2 class="font-bold text-lg mb-3">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2><div class="space-y-3 mb-6">`;
            
            STATE.cart.forEach((item, idx) => {
                html += `
                    <div class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex items-center gap-3">
                        <div class="w-12 h-12 bg-gray-50 rounded-lg flex items-center justify-center text-2xl">${item.img}</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-sm">${item.name}</h4>
                            <div class="flex items-center gap-2 mt-1">
                                <button onclick="STATE.cart[${idx}].qty > 1 ? STATE.cart[${idx}].qty-- : null; renderUserCart();" class="w-5 h-5 bg-gray-100 rounded text-xs">-</button>
                                <span class="text-xs font-bold w-4 text-center">${item.qty}</span>
                                <button onclick="STATE.cart[${idx}].qty++; renderUserCart();" class="w-5 h-5 bg-gray-100 rounded text-xs">+</button>
                            </div>
                        </div>
                        <button onclick="STATE.cart.splice(${idx},1); renderUserCart(); renderTabs();" class="text-red-500"><i class="fas fa-trash"></i></button>
                    </div>
                `;
            });

            html += `</div>
                <div class="bg-gray-50 p-4 rounded-xl mb-6">
                    <h3 class="font-bold text-xs text-gray-500 mb-2 uppercase">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h3>
                    <input type="datetime-local" class="w-full bg-white border border-gray-200 rounded p-2 text-xs mb-2">
                    <textarea class="w-full bg-white border border-gray-200 rounded p-2 text-xs h-16" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•..."></textarea>
                </div>
                <button onclick="submitOrder()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg shadow-blue-500/30">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
            </div>`;
            main.innerHTML = html;
        }

        function submitOrder() {
            Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô?',
                text: "‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#2563eb',
                confirmButtonText: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô'
            }).then((result) => {
                if (result.isConfirmed) {
                    const orderId = 'R-' + Math.floor(Math.random() * 1000);
                    const itemsText = STATE.cart.map(i => `${i.name} x${i.qty}`).join(', ');
                    
                    DB.requests.unshift({
                        id: orderId,
                        user: '‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢',
                        items: STATE.cart.map(i => ({name: i.name, qty: i.qty})),
                        status: 'pending',
                        date: 'Just Now'
                    });
                    
                    STATE.cart = [];
                    renderTabs();
                    renderUserStatus();
                    
                    // Trigger Fake Line Notify
                    triggerNotification(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${orderId} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'flex-request');
                }
            });
        }

        function renderUserStatus() {
            const main = document.getElementById('main-view');
            let html = `<div class="px-4 py-2"><h2 class="font-bold text-lg mb-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏Ç‡∏≠</h2><div class="space-y-3">`;
            
            DB.requests.forEach(req => {
                let badge = req.status === 'approved' 
                    ? '<span class="bg-green-100 text-green-600 text-[10px] px-2 py-0.5 rounded font-bold">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>'
                    : '<span class="bg-orange-100 text-orange-600 text-[10px] px-2 py-0.5 rounded font-bold">‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</span>';
                
                html += `
                    <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm">
                        <div class="flex justify-between mb-2">
                            <span class="font-mono text-xs text-gray-500">${req.id} ‚Ä¢ ${req.date}</span>
                            ${badge}
                        </div>
                        <div class="bg-gray-50 p-2 rounded text-xs text-gray-700 mb-3">
                            ${req.items.map(i => `<div>- ${i.name} x${i.qty}</div>`).join('')}
                        </div>
                        ${req.status === 'approved' ? 
                            `<button onclick="renderUserQR('${req.id}')" class="w-full bg-green-500 text-white py-2 rounded-lg text-xs font-bold"><i class="fas fa-qrcode mr-1"></i> ‡∏™‡πÅ‡∏Å‡∏ô‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</button>` : 
                            '<button class="w-full bg-gray-100 text-gray-400 py-2 rounded-lg text-xs font-bold cursor-not-allowed">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>'}
                    </div>
                `;
            });
            html += `</div></div>`;
            main.innerHTML = html;
        }

        function renderUserQR(id) {
            Swal.fire({
                title: 'QR ‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á',
                text: '‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô',
                html: `<div class="bg-white p-4 inline-block rounded-xl border-4 border-green-500 mb-2"><i class="fas fa-qrcode text-6xl"></i></div><br><span class="font-mono font-bold">${id}</span>`,
                confirmButtonText: '‡∏õ‡∏¥‡∏î'
            });
        }

        // ==========================================
        // VIEW: STAFF
        // ==========================================
        function renderStaffDashboard() {
            const main = document.getElementById('main-view');
            main.innerHTML = `
                <div class="px-4 py-2">
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div class="bg-blue-600 rounded-xl p-4 text-white shadow-lg relative overflow-hidden">
                            <i class="fas fa-box absolute -right-3 -bottom-3 text-6xl opacity-20"></i>
                            <div class="text-2xl font-bold">${DB.requests.filter(r => r.status === 'approved').length}</div>
                            <div class="text-xs opacity-80">‡∏£‡∏≠‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö</div>
                        </div>
                        <div class="bg-orange-500 rounded-xl p-4 text-white shadow-lg relative overflow-hidden">
                            <i class="fas fa-clock absolute -right-3 -bottom-3 text-6xl opacity-20"></i>
                            <div class="text-2xl font-bold">${DB.requests.filter(r => r.status === 'pending').length}</div>
                            <div class="text-xs opacity-80">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
                        </div>
                    </div>

                    <h3 class="font-bold text-sm text-gray-700 mb-2">Quick Actions</h3>
                    <div class="grid grid-cols-3 gap-2 mb-6">
                        <button onclick="renderScanner()" class="flex flex-col items-center bg-gray-50 p-3 rounded-xl hover:bg-blue-50 transition border border-gray-100">
                            <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center mb-1"><i class="fas fa-qrcode"></i></div>
                            <span class="text-[10px] font-bold">‡∏™‡πÅ‡∏Å‡∏ô</span>
                        </button>
                        <button class="flex flex-col items-center bg-gray-50 p-3 rounded-xl hover:bg-green-50 transition border border-gray-100">
                            <div class="w-8 h-8 rounded-full bg-green-100 text-green-600 flex items-center justify-center mb-1"><i class="fas fa-plus"></i></div>
                            <span class="text-[10px] font-bold">‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô</span>
                        </button>
                        <button class="flex flex-col items-center bg-gray-50 p-3 rounded-xl hover:bg-red-50 transition border border-gray-100">
                            <div class="w-8 h-8 rounded-full bg-red-100 text-red-600 flex items-center justify-center mb-1"><i class="fas fa-wrench"></i></div>
                            <span class="text-[10px] font-bold">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</span>
                        </button>
                    </div>

                    <h3 class="font-bold text-sm text-gray-700 mb-2">Log ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h3>
                    <div class="bg-white rounded-xl border border-gray-100 shadow-sm overflow-hidden">
                        ${DB.logs.slice(0,3).map(l => `
                            <div class="flex items-center p-3 border-b border-gray-50 last:border-0">
                                <span class="text-xs font-mono text-gray-400 mr-3">${l.time}</span>
                                <div>
                                    <div class="text-xs font-bold text-gray-700">${l.actor}</div>
                                    <div class="text-[10px] text-gray-500">${l.action}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderStaffTasks() {
            const main = document.getElementById('main-view');
            const pendings = DB.requests.filter(r => r.status === 'pending');
            
            let html = `<div class="px-4 py-2"><h2 class="font-bold text-lg mb-3">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (${pendings.length})</h2><div class="space-y-3">`;
            
            if(pendings.length === 0) {
                html += `<div class="text-center text-gray-400 mt-10"><i class="fas fa-check-circle text-4xl mb-2"></i><p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</p></div>`;
            }

            pendings.forEach(req => {
                html += `
                    <div class="bg-white p-4 rounded-xl border-l-4 border-blue-500 shadow-sm">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-bold text-sm">${req.user}</h4>
                                <span class="text-[10px] text-gray-500">User Credit: A</span>
                            </div>
                            <span class="text-[10px] text-gray-400">${req.date}</span>
                        </div>
                        <div class="bg-gray-50 p-2 rounded text-xs text-gray-600 mb-3">
                            ${req.items.map(i => `<div>‚Ä¢ ${i.name} x${i.qty}</div>`).join('')}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="approveRequest('${req.id}')" class="flex-1 bg-green-500 text-white py-2 rounded-lg text-xs font-bold shadow-sm">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                            <button class="flex-1 bg-gray-100 text-gray-600 py-2 rounded-lg text-xs font-bold">‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</button>
                        </div>
                    </div>
                `;
            });
            html += `</div></div>`;
            main.innerHTML = html;
        }

        function approveRequest(id) {
            Swal.fire({ title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥?', icon: 'warning', showCancelButton: true, confirmButtonColor: '#22c55e', confirmButtonText: 'Yes' }).then((res) => {
                if(res.isConfirmed) {
                    const req = DB.requests.find(r => r.id === id);
                    req.status = 'approved';
                    
                    DB.logs.unshift({ time: moment().format('HH:mm'), actor: 'Staff', action: `Approved ${id}` });
                    
                    renderStaffTasks();
                    renderTabs(); // Update badge
                    
                    // Trigger Notification to User (Simulation)
                    setTimeout(() => {
                        triggerNotification(`‡∏Ñ‡∏≥‡∏Ç‡∏≠ ${id} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß`, 'flex-approve');
                    }, 1000);
                }
            });
        }

        function renderScanner() {
            const main = document.getElementById('main-view');
            main.innerHTML = `
                <div class="h-full bg-black relative flex flex-col items-center justify-center overflow-hidden">
                    <img src="https://images.unsplash.com/photo-1566576912322-7e8abb0eb9e5?w=800&q=80" class="absolute inset-0 w-full h-full object-cover opacity-50">
                    
                    <div class="w-64 h-64 border-2 border-green-400 rounded-3xl relative z-10">
                        <div class="absolute top-0 left-0 w-8 h-8 border-t-4 border-l-4 border-green-500 -mt-1 -ml-1"></div>
                        <div class="absolute top-0 right-0 w-8 h-8 border-t-4 border-r-4 border-green-500 -mt-1 -mr-1"></div>
                        <div class="absolute bottom-0 left-0 w-8 h-8 border-b-4 border-l-4 border-green-500 -mb-1 -ml-1"></div>
                        <div class="absolute bottom-0 right-0 w-8 h-8 border-b-4 border-r-4 border-green-500 -mb-1 -mr-1"></div>
                        <div class="w-full h-0.5 bg-green-500 shadow-[0_0_15px_rgba(34,197,94,1)] absolute top-1/2 animate-[pulse_1.5s_infinite]"></div>
                    </div>
                    
                    <div class="z-10 mt-8 text-center">
                        <p class="text-white font-bold animate-pulse mb-4">Searching for QR Code...</p>
                        <button onclick="Swal.fire('Scan Found', 'Found R-099<br>User: ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢', 'success')" class="bg-white/20 backdrop-blur border border-white/50 text-white px-6 py-2 rounded-full text-xs font-bold">
                            Simulate Scan
                        </button>
                    </div>
                </div>
            `;
        }

        // ==========================================
        // VIEW: ADMIN
        // ==========================================
        function renderAdminUsers() {
            const main = document.getElementById('main-view');
            const pendingUsers = DB.users.filter(u => u.status === 'pending');
            
            let html = `<div class="px-4 py-2">
                <div class="bg-gray-50 rounded-xl p-3 mb-4 flex justify-between items-center border border-gray-200">
                    <span class="text-xs font-bold text-gray-600">Total Users</span>
                    <span class="text-lg font-bold text-blue-600">${DB.users.length}</span>
                </div>
                
                <h3 class="font-bold text-sm text-gray-700 mb-2">New Registrations (${pendingUsers.length})</h3>
                <div class="space-y-2 mb-6">`;

            if(pendingUsers.length === 0) html += `<div class="text-center text-xs text-gray-400 py-4">No pending users</div>`;

            pendingUsers.forEach(u => {
                html += `
                    <div class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex justify-between items-center">
                        <div>
                            <div class="font-bold text-sm">${u.name}</div>
                            <div class="text-[10px] text-gray-500">${u.dept} ‚Ä¢ ${u.role}</div>
                        </div>
                        <div class="flex gap-1">
                            <button onclick="approveUser('${u.id}')" class="w-7 h-7 bg-green-100 text-green-600 rounded flex items-center justify-center"><i class="fas fa-check text-xs"></i></button>
                            <button class="w-7 h-7 bg-red-100 text-red-600 rounded flex items-center justify-center"><i class="fas fa-times text-xs"></i></button>
                        </div>
                    </div>
                `;
            });

            html += `</div>
                <h3 class="font-bold text-sm text-gray-700 mb-2">Active Users</h3>
                <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                    ${DB.users.filter(u => u.status === 'active').map(u => `
                        <div class="p-3 border-b border-gray-50 flex justify-between items-center text-xs">
                            <span class="font-bold text-gray-700">${u.name}</span>
                            <span class="bg-gray-100 px-2 py-0.5 rounded text-gray-500">${u.role}</span>
                        </div>
                    `).join('')}
                </div>
            </div>`;
            main.innerHTML = html;
        }

        function approveUser(id) {
            const u = DB.users.find(u => u.id === id);
            u.status = 'active';
            Swal.fire('Approved', `${u.name} is now active`, 'success');
            renderAdminUsers();
        }

        function renderAdminStock() {
            const main = document.getElementById('main-view');
            let html = `<div class="px-4 py-2"><h2 class="font-bold text-lg mb-3">Stock Management</h2><div class="space-y-2">`;
            
            DB.assets.forEach(a => {
                html += `
                    <div class="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex items-center gap-3">
                        <div class="w-10 h-10 bg-gray-50 rounded flex items-center justify-center text-xl">${a.img}</div>
                        <div class="flex-1">
                            <div class="font-bold text-sm">${a.name}</div>
                            <div class="text-[10px] text-gray-400">Total: ${a.stock}</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="updateStock(${a.id}, -1)" class="w-6 h-6 bg-gray-100 rounded text-gray-600 font-bold">-</button>
                            <span class="text-xs font-bold w-4 text-center" id="stock-${a.id}">${a.stock}</span>
                            <button onclick="updateStock(${a.id}, 1)" class="w-6 h-6 bg-gray-100 rounded text-blue-600 font-bold">+</button>
                        </div>
                    </div>
                `;
            });
            html += `</div></div>`;
            main.innerHTML = html;
        }

        function updateStock(id, delta) {
            const asset = DB.assets.find(a => a.id === id);
            asset.stock += delta;
            renderAdminStock();
        }

        // ==========================================
        // VIEW: EXECUTIVE
        // ==========================================
        function renderExecDashboard() {
            const main = document.getElementById('main-view');
            main.innerHTML = `
                <div class="px-4 py-2">
                    <div class="bg-gradient-to-br from-indigo-900 to-purple-900 rounded-xl p-4 text-white shadow-lg mb-4">
                        <h2 class="text-xs font-bold text-indigo-200 mb-1 uppercase">Social Impact (Month)</h2>
                        <div class="flex items-baseline gap-2 mb-3">
                            <span class="text-3xl font-bold">1,248</span>
                            <span class="text-xs text-indigo-200">Transactions</span>
                        </div>
                        <div class="grid grid-cols-2 gap-4 text-xs border-t border-indigo-700 pt-3">
                            <div>
                                <span class="block text-indigo-300">Beneficiaries</span>
                                <span class="font-bold text-lg">~5k People</span>
                            </div>
                            <div>
                                <span class="block text-indigo-300">Budget Saved</span>
                                <span class="font-bold text-lg">‡∏ø 2.5M</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm mb-4">
                        <h3 class="font-bold text-sm text-gray-700 mb-2">Category Utilization</h3>
                        <canvas id="utilChart" height="200"></canvas>
                    </div>

                    <h3 class="font-bold text-sm text-gray-700 mb-2">Top 5 Popular Items</h3>
                    <div class="space-y-2 mb-6">
                        ${DB.assets.sort((a,b) => b.pop - a.pop).slice(0,5).map(a => `
                            <div class="bg-white p-2 rounded-lg border border-gray-100 shadow-sm">
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="font-bold text-gray-700">${a.img} ${a.name}</span>
                                    <span class="text-blue-600 font-bold">${a.pop}%</span>
                                </div>
                                <div class="h-1.5 bg-gray-100 rounded-full overflow-hidden">
                                    <div class="h-full bg-blue-500 rounded-full" style="width: ${a.pop}%"></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <h3 class="font-bold text-sm text-gray-700 mb-2">Damage Report</h3>
                    <div class="bg-white rounded-xl border border-gray-100 overflow-hidden">
                         <table class="w-full text-left text-[10px]">
                            <thead class="bg-gray-50 text-gray-500 uppercase">
                                <tr><th class="p-2">Item</th><th class="p-2">Issue</th><th class="p-2">Date</th></tr>
                            </thead>
                            <tbody class="divide-y divide-gray-50">
                                <tr><td class="p-2">‡πÄ‡∏Å‡πâ‡∏≤‡∏≠‡∏µ‡πâ‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å</td><td class="p-2 text-red-500">‡∏Ç‡∏≤‡∏´‡∏±‡∏Å</td><td class="p-2 text-gray-400">Jan 20</td></tr>
                                <tr><td class="p-2">‡πÑ‡∏°‡∏Ñ‡πå‡∏•‡∏≠‡∏¢</td><td class="p-2 text-red-500">‡∏ï‡∏Å‡∏ô‡πâ‡∏≥</td><td class="p-2 text-gray-400">Jan 18</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            // Init Chart
            setTimeout(() => {
                const ctx = document.getElementById('utilChart').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Furniture', 'Tech', 'Outdoor', 'Audio'],
                        datasets: [{
                            data: [300, 50, 100, 40],
                            backgroundColor: ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b'],
                            borderWidth: 0
                        }]
                    },
                    options: { plugins: { legend: { position: 'right', labels: { boxWidth: 10, font: {size: 10} } } } }
                });
            }, 100);
        }

        // --- INIT ---
        setRole('user'); // Start as User

    </script>
</body>
</html>
